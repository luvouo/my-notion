<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal Projects — Logic / Art</title>

  <style>
    :root{
      --bg: rgba(255,255,255,0.00);
      --panel: rgba(255,255,255,0.62);
      --panel2: rgba(255,255,255,0.42);

      --text: rgba(18,18,18,0.92);
      --muted: rgba(18,18,18,0.52);
      --line: rgba(0,0,0,0.10);
      --line2: rgba(0,0,0,0.07);

      /* Theme */
      --logic: rgba(120, 168, 255, 0.92);
      --logicSoft: rgba(120, 168, 255, 0.16);

      --art: rgba(213, 192, 251, 0.92);
      --artSoft: rgba(213, 192, 251, 0.18);

      /* Minimal geometry */
      --r: 10px;
      --pad: 14px;
    }

    @font-face{
      font-family: "ObjectiveThinItalic";
      src: url("../fonts/Objective-Thin-Italic.woff2") format("woff2");
      font-weight: 300;
      font-style: italic;
      font-display: swap;
    }

    html, body{
      margin:0; padding:0;
      background: transparent;
      color: var(--text);
      font-family: "ObjectiveThinItalic",
        ui-sans-serif, system-ui, -apple-system,
        "Apple SD Gothic Neo","Noto Sans KR", sans-serif;
    }

    .wrap{
      width: min(980px, 100%);
      margin: 0 auto;
      padding: clamp(10px, 2.6vw, 16px);
      box-sizing: border-box;
    }

    .shell{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow: hidden;
    }

    /* Top bar (minimal) */
    .topbar{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid var(--line2);
      background: rgba(255,255,255,0.10);
    }

    .crumb{
      display:flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
      font-size: 12px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      color: rgba(18,18,18,0.76);
      user-select: none;
    }
    .crumb a{
      color: rgba(18,18,18,0.76);
      text-decoration: none;
      cursor: pointer;
      padding: 6px 8px;
      border-radius: 8px;
    }
    .crumb a:hover{
      background: rgba(255,255,255,0.18);
      box-shadow: 0 0 0 2px rgba(0,0,0,0.04) inset;
    }
    .sep{ opacity: .45; }

    .rightNav{
      display:flex;
      align-items:center;
      gap: 8px;
    }

    .altCat{
      border: 1px solid var(--line);
      padding: 7px 10px;
      font-size: 12px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      cursor: pointer;
      user-select:none;
      background: rgba(255,255,255,0.14);
      color: rgba(18,18,18,0.78);
      transition: background .18s ease, box-shadow .18s ease, border-color .18s ease;
      white-space: nowrap;
    }
    .altCat:hover{
      box-shadow: 0 0 0 3px rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.14);
    }

    .altCat.logicGlow{
      background:
        radial-gradient(120% 140% at 0% 50%, var(--logicSoft), transparent 60%),
        rgba(255,255,255,0.12);
    }
    .altCat.artGlow{
      background:
        radial-gradient(120% 140% at 0% 50%, var(--artSoft), transparent 60%),
        rgba(255,255,255,0.12);
    }

    /* Views container */
    .views{ position: relative; min-height: 460px; }
    .view{
      position:absolute; inset:0;
      padding: 14px;
      box-sizing: border-box;
      opacity:0;
      transform: translateY(8px);
      pointer-events:none;
      transition: opacity .20s ease, transform .20s ease;
    }
    .view.active{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    /* HOME view: only two categories */
    .homeGrid{
      height: 100%;
      display:grid;
      place-items: center;
    }
    .catRow{
      width: min(760px, 100%);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 720px){
      .catRow{ grid-template-columns: 1fr; }
      .views{ min-height: 520px; }
    }

    .cat{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.52);
      padding: 22px;
      min-height: 150px;
      cursor:pointer;
      user-select:none;
      transition: background .18s ease, border-color .18s ease, box-shadow .18s ease;
      display:flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
    }
    .cat h3{
      margin:0;
      font-size: 20px;
      letter-spacing: -0.4px;
      font-weight: 560;
      text-transform: none;
    }
    .cat p{
      margin:0;
      font-size: 12px;
      color: var(--muted);
    }

    @media (hover:hover) and (pointer:fine){
      .cat.logic:hover{ background: rgba(255,255,255,0.58); box-shadow: 0 0 0 3px var(--logicSoft) inset; }
      .cat.art:hover{ background: rgba(255,255,255,0.58); box-shadow: 0 0 0 3px var(--artSoft) inset; }
    }

    /* LIST view */
    .listWrap{
      height: 100%;
      display:grid;
      gap: 12px;
      grid-template-rows: auto auto 1fr;
    }

    .listToolbar{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--line2);
      padding-bottom: 10px;
    }

    .createRow{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap: wrap;
    }

    .input{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.68);
      padding: 10px 10px;
      outline: none;
      font-size: 13px;
      color: rgba(18,18,18,0.88);
      min-width: 240px;
      box-sizing: border-box;
      border-radius: 0; /* minimal */
    }
    .input::placeholder{ color: rgba(18,18,18,0.42); }

    .select{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.68);
      padding: 10px 10px;
      outline: none;
      font-size: 12px;
      color: rgba(18,18,18,0.78);
      border-radius: 0; /* minimal */
      cursor: pointer;
    }

    .btn{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.12);
      padding: 10px 12px;
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      cursor:pointer;
      user-select:none;
      transition: background .16s ease, box-shadow .16s ease, border-color .16s ease, transform .08s ease;
      color: rgba(18,18,18,0.78);
      border-radius: 0; /* minimal */
      white-space: nowrap;
    }
    .btn:hover{
      box-shadow: 0 0 0 3px rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.14);
      background: rgba(255,255,255,0.18);
    }
    .btn:active{ transform: scale(0.99); }
    .btn.danger{ background: rgba(0,0,0,0.03); }

    .btn.logicAccent{ box-shadow: 0 0 0 3px var(--logicSoft) inset; }
    .btn.artAccent{ box-shadow: 0 0 0 3px var(--artSoft) inset; }

    .sortRow{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .sortLabel{
      font-size: 11px;
      color: rgba(18,18,18,0.60);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    /* Folder + list panel */
    .panel{
      border-top: 1px solid var(--line2);
      padding-top: 10px;
    }

    .folderHead{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      padding: 6px 0 10px;
      border-bottom: 1px solid var(--line2);
      margin-bottom: 10px;
    }
    .folderLeft{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap: wrap;
      min-width: 0;
    }
    .tiny{
      font-size: 11px;
      color: rgba(18,18,18,0.56);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    /* Empty center box (no dashed border, centered) */
    .emptyCenter{
      height: 100%;
      min-height: 300px;
      display:grid;
      place-items: center;
    }
    .emptyBox{
      width: min(520px, 100%);
      border: 1px solid var(--line2);   /* dotted 제거 */
      background: rgba(255,255,255,0.36);
      padding: 18px;
      display:grid;
      gap: 12px;
      text-align: center;               /* 가운데 정렬 */
    }
    .emptyBox p{
      margin:0;
      font-size: 12px;
      color: rgba(18,18,18,0.62);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    .emptyBox .createRow{
      justify-content: center;
    }

    /* Folder sections */
    .folderBlock{
      margin-top: 10px;
    }
    .folderTitle{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid var(--line2);
    }
    .folderTitle strong{
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: rgba(18,18,18,0.76);
    }
    .folderTitle .count{
      font-size: 11px;
      color: rgba(18,18,18,0.52);
    }

    /* Project rows: no rounded boxes, only separators */
    .projList{
      display:grid;
    }
    .projRow{
      width: 100%;
      text-align:left;
      border: none;
      border-bottom: 1px solid var(--line2);
      background: transparent;
      padding: 12px 4px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      font-size: 13.5px;
      letter-spacing: -0.2px;
      color: rgba(18,18,18,0.88);
      transition: background .14s ease;
    }

    @media (hover:hover) and (pointer:fine){
      .projRow:hover{
        background: rgba(255,255,255,0.18);
      }
    }
    @media (hover:none) and (pointer:coarse){
      .projRow:active{
        background: rgba(255,255,255,0.22);
      }
    }

    /* Modal */
    .overlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: rgba(0,0,0,0.24);
      z-index: 9999;
    }
    .overlay.open{ display:flex; }

    .modal{
      width: min(940px, 100%);
      max-height: calc(100vh - 24px);
      border: 1px solid rgba(0,0,0,0.16);
      background: rgba(255,255,255,0.88);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      display:flex;
      flex-direction: column;
    }

    .mHead{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid var(--line2);
      flex-wrap: wrap;
    }

    .mTitle{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
      flex: 1 1 auto;
    }
    .mTitle strong{
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      color: rgba(18,18,18,0.78);
    }
    .badge{
      font-size: 11px;
      padding: 6px 10px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.50);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: rgba(18,18,18,0.70);
      white-space: nowrap;
    }
    .badge.logic{ box-shadow: 0 0 0 3px var(--logicSoft) inset; }
    .badge.art{ box-shadow: 0 0 0 3px var(--artSoft) inset; }

    .mActions{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .mBody{
      padding: 14px;
      overflow:auto;
      display:grid;
      gap: 12px;
    }

    .section{
      border-top: 1px solid var(--line2);
      padding-top: 12px;
      display:grid;
      gap: 10px;
    }

    .secHead{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .secHead .secTitle{
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: rgba(18,18,18,0.70);
    }
    .secHead .secMeta{
      font-size: 11px; /* 0.5px 정도 작게 */
      color: rgba(18,18,18,0.50);
      text-transform: uppercase;
      letter-spacing: 0.2px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 820px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .label{
      font-size: 11px;
      color: rgba(18,18,18,0.56);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.2px;
    }

    .tInput, .tArea{
      width:100%;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.70);
      padding: 10px 10px;
      outline: none;
      font-size: 13px;
      color: rgba(18,18,18,0.88);
      box-sizing: border-box;
      border-radius: 0; /* minimal */
      font-family: "ObjectiveThinItalic",
        ui-sans-serif, system-ui, -apple-system,
        "Apple SD Gothic Neo","Noto Sans KR", sans-serif;
    }
    .tArea{
      min-height: 90px;
      resize: vertical;
      line-height: 1.45;
      font-size: 12.8px;
    }

    /* Progress tags (multi select) */
    .tagRow{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
    }
    .tagBtn{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.12);
      padding: 8px 10px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      cursor:pointer;
      user-select:none;
      transition: background .14s ease, box-shadow .14s ease, border-color .14s ease;
      border-radius: 0;
      color: rgba(18,18,18,0.70);
    }
    .tagBtn.on{
      background: rgba(255,255,255,0.26);
      border-color: rgba(0,0,0,0.16);
    }
    .tagBtn.on.logic{ box-shadow: 0 0 0 3px var(--logicSoft) inset; }
    .tagBtn.on.art{ box-shadow: 0 0 0 3px var(--artSoft) inset; }

    /* Gallery rows with thumb */
    .gRow{
      display:grid;
      grid-template-columns: 52px 1fr auto;
      gap: 10px;
      align-items:center;
      border-bottom: 1px solid var(--line2);
      padding: 8px 0;
    }
    .thumb{
      width: 52px; height: 52px;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,0.40);
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .thumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
    }
    .ph{
      font-size: 10px;
      color: rgba(18,18,18,0.45);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    /* Undo toast */
    .undoToast{
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      display:none;
      align-items:center;
      gap: 10px;
      border: 1px solid rgba(0,0,0,0.16);
      background: rgba(255,255,255,0.88);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 10px 12px;
      z-index: 10000;
      max-width: calc(100vw - 24px);
      box-sizing: border-box;
    }
    .undoToast.open{ display:flex; }
    .undoToast .msg{
      font-size: 12px;
      color: rgba(18,18,18,0.78);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 60vw;
      text-transform: uppercase;
      letter-spacing: 0.2px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">
      <div class="topbar">
        <div class="crumb" id="crumb">
          <!-- filled by JS -->
        </div>

        <div class="rightNav">
          <button class="altCat" id="altCatBtn" type="button" style="display:none;">ART</button>
        </div>
      </div>

      <div class="views">
        <!-- HOME -->
        <div class="view active" id="viewHome" aria-label="Home">
          <div class="homeGrid">
            <div class="catRow">
              <div class="cat logic" id="pickLogic" role="button" tabindex="0" aria-label="Logic">
                <h3>Logic</h3>
                <p>system / build / widgets</p>
              </div>
              <div class="cat art" id="pickArt" role="button" tabindex="0" aria-label="Art">
                <h3>Art</h3>
                <p>visual / SD / assets</p>
              </div>
            </div>
          </div>
        </div>

        <!-- LIST -->
        <div class="view" id="viewList" aria-label="Project List">
          <div class="listWrap">

            <!-- Toolbar: create + folder + sort -->
            <div class="listToolbar" id="listToolbar">
              <div class="createRow" id="createRow">
                <input class="input" id="newName" type="text" maxlength="60" placeholder="+ NEW PROJECT" />
                <select class="select" id="folderSelect"></select>
                <button class="btn" id="createBtn" type="button">CREATE</button>
              </div>

              <div class="sortRow" id="sortRow">
                <span class="sortLabel">SORT</span>
                <select class="select" id="sortKey">
                  <option value="name">NAME</option>
                  <option value="updatedAt">RECENT</option>
                  <option value="createdAt">CREATED</option>
                </select>
                <select class="select" id="sortDir">
                  <option value="asc">ASC</option>
                  <option value="desc" selected>DESC</option>
                </select>
              </div>
            </div>

            <!-- Folder manage row -->
            <div class="folderHead" id="folderHead">
              <div class="folderLeft">
                <span class="tiny">FOLDERS</span>
                <input class="input" id="newFolderName" type="text" maxlength="30" placeholder="+ NEW FOLDER" style="min-width:200px;" />
                <button class="btn" id="addFolderBtn" type="button">ADD</button>
              </div>
              <div class="tiny" id="folderHint"></div>
            </div>

            <div class="panel" id="panel">
              <div id="listPanel"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DETAIL MODAL -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Project Detail">
      <div class="mHead">
        <div class="mTitle">
          <strong id="mName">PROJECT</strong>
          <span class="badge" id="mBadge">LOGIC</span>
        </div>
        <div class="mActions">
          <button class="btn danger" id="deleteBtn" type="button">DELETE</button>
          <button class="btn" id="closeBtn" type="button">CLOSE</button>
        </div>
      </div>
      <div class="mBody" id="mBody"></div>
    </div>
  </div>

  <!-- UNDO TOAST -->
  <div class="undoToast" id="undoToast" aria-live="polite">
    <div class="msg" id="undoMsg">DELETED</div>
    <button class="btn" id="undoBtn" type="button">UNDO</button>
  </div>

  <script>
    /* ========= workspace scoped keys ========= */
    const WORKSPACE_ID_STORAGE_KEY = "soft_schedule_workspace_id_v1";
    function getWorkspaceIdMaybe(){
      const v = localStorage.getItem(WORKSPACE_ID_STORAGE_KEY);
      return (v && String(v).trim()) ? String(v).trim() : "";
    }
    const wid = getWorkspaceIdMaybe();

    const KEY_LOGIC = wid ? `pp_projects_logic_${wid}_v3` : "pp_projects_logic_v3";
    const KEY_ART   = wid ? `pp_projects_art_${wid}_v3`   : "pp_projects_art_v3";
    const KEY_FOLDERS = wid ? `pp_projects_folders_${wid}_v3` : "pp_projects_folders_v3";

    /* ========= utils ========= */
    const $ = (id)=>document.getElementById(id);
    function uid(){ return (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()+Math.random())); }
    function pad2(n){ return String(n).padStart(2,"0"); }
    function nowIso(){
      const d = new Date();
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    }
    function safeParse(raw, fallback){
      try{ const v = JSON.parse(raw); return v ?? fallback; }catch(_){ return fallback; }
    }
    function loadArr(key){
      const raw = localStorage.getItem(key);
      const arr = raw ? safeParse(raw, []) : [];
      return Array.isArray(arr) ? arr : [];
    }
    function saveArr(key, arr){
      localStorage.setItem(key, JSON.stringify(Array.isArray(arr)?arr:[]));
    }
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    /* ========= state ========= */
    let logic = loadArr(KEY_LOGIC);
    let art   = loadArr(KEY_ART);
    let folders = safeParse(localStorage.getItem(KEY_FOLDERS) || "", {
      logic: ["INBOX"],
      art: ["INBOX"]
    });
    if(!folders || typeof folders !== "object") folders = { logic:["INBOX"], art:["INBOX"] };
    if(!Array.isArray(folders.logic) || !folders.logic.length) folders.logic = ["INBOX"];
    if(!Array.isArray(folders.art) || !folders.art.length) folders.art = ["INBOX"];

    let activeCat = null; // "logic" | "art" | null
    let openId = null;
    let isComposing = false;

    // sort
    let sortKey = "updatedAt";
    let sortDir = "desc";

    // undo delete
    let pendingDelete = null; // {cat, item, index, timer}

    function persist(){
      saveArr(KEY_LOGIC, logic);
      saveArr(KEY_ART, art);
      localStorage.setItem(KEY_FOLDERS, JSON.stringify(folders));
    }

    function listRef(cat){ return (cat==="logic") ? logic : art; }
    function setList(cat, next){ if(cat==="logic") logic = next; else art = next; }

    /* ========= model ========= */
    const PROGRESS_TAGS = [
      { key: "before", label: "진행 전" },
      { key: "doing",  label: "진행 중" },
      { key: "done",   label: "진행 완료" },
      { key: "expand", label: "확장 예정" }
    ];

    function baseProject(name, type, folderName){
      return {
        id: uid(),
        type,
        folder: folderName || "INBOX",

        name: name || "NEW PROJECT",
        createdAt: nowIso(),
        updatedAt: nowIso(),

        subtitle: "",
        overview: "",
        features: "",
        revisions: "",
        revisionsPrompt: "",   // ✅ per-revisions prompt
        additions: "",
        additionsPrompt: "",   // ✅ per-additions prompt

        progressTags: []       // ✅ multi tag
      };
    }

    function newLogic(name, folderName){
      return {
        ...baseProject(name, "logic", folderName),
        category: "",
        target: "",
        logicSheet: {
          spec: "",
          log: "",
          promptBank: ""  // ✅ keep as core prompt/memo
        }
      };
    }

    function newArt(name, folderName){
      return {
        ...baseProject(name, "art", folderName),
        assetGroup: "",
        designTokens: "",
        promptRecipe: "",
        generation: {
          checkpoint: "",
          lora: "",
          prompt: "",
          negative: "",
          seed: "",
          sampler: "",
          gallery: [""] // urls
        }
      };
    }

    function findProject(cat, id){
      return listRef(cat).find(p => p.id === id) || null;
    }

    function updateProject(cat, id, mutator){
      const arr = listRef(cat);
      const idx = arr.findIndex(p => p.id === id);
      if(idx < 0) return;
      const next = structuredClone(arr[idx]);
      mutator(next);
      next.updatedAt = nowIso();
      const out = arr.slice();
      out[idx] = next;
      setList(cat, out);
      persist();
    }

    /* ========= crumb + top right alt category ========= */
    function renderTopbar(){
      const crumb = $("crumb");
      const altBtn = $("altCatBtn");

      if(!activeCat){
        crumb.innerHTML = `<span style="opacity:.75;">PROJECTS</span>`;
        altBtn.style.display = "none";
        return;
      }

      const catLabel = activeCat === "logic" ? "LOGIC" : "ART";
      const otherCat = activeCat === "logic" ? "ART" : "LOGIC";

      crumb.innerHTML = `
        <a id="crumbProjects">PROJECTS</a>
        <span class="sep">/</span>
        <span style="opacity:.75;">${catLabel}</span>
      `;

      const cp = $("crumbProjects");
      cp.addEventListener("click", ()=> setViewHome());

      // right top: other category with gradient glow
      altBtn.style.display = "";
      altBtn.textContent = otherCat;
      altBtn.className = "altCat " + (activeCat === "logic" ? "artGlow" : "logicGlow");
      altBtn.onclick = ()=> setViewList(activeCat === "logic" ? "art" : "logic");
    }

    /* ========= view switching ========= */
    function setViewHome(){
      activeCat = null;
      $("viewHome").classList.add("active");
      $("viewList").classList.remove("active");
      $("overlay").classList.remove("open");
      $("overlay").setAttribute("aria-hidden","true");
      openId = null;
      renderTopbar();
    }

    function setViewList(cat){
      activeCat = cat;
      $("viewHome").classList.remove("active");
      $("viewList").classList.add("active");

      // default sort: recent desc
      sortKey = "updatedAt";
      sortDir = "desc";
      $("sortKey").value = sortKey;
      $("sortDir").value = sortDir;

      // folder hint theme
      $("folderHint").textContent = (cat==="logic") ? "PASTEL BLUE THEME" : "PASTEL PURPLE THEME";

      renderFolderSelect();
      renderTopbar();
      renderList();

      setTimeout(()=> $("newName").focus(), 0);
    }

    /* ========= folders ========= */
    function normalizeFolderName(s){
      const v = String(s||"").trim();
      if(!v) return "";
      // minimal normalize
      return v.toUpperCase().slice(0, 30);
    }

    function renderFolderSelect(){
      const sel = $("folderSelect");
      const list = (activeCat==="logic") ? folders.logic : folders.art;
      sel.innerHTML = list.map(f => `<option value="${escapeHtml(f)}">${escapeHtml(f)}</option>`).join("");
    }

    function addFolder(){
      const inp = $("newFolderName");
      const nm = normalizeFolderName(inp.value);
      if(!nm) return;
      const list = (activeCat==="logic") ? folders.logic : folders.art;
      if(list.includes(nm)) { inp.value=""; return; }
      list.push(nm);
      persist();
      inp.value = "";
      renderFolderSelect();
      renderList();
    }

    $("addFolderBtn").addEventListener("click", addFolder);
    $("newFolderName").addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){ e.preventDefault(); addFolder(); }
    });

    /* ========= sorting ========= */
    function cmp(a,b, key){
      const av = String(a[key]||"");
      const bv = String(b[key]||"");
      if(key === "name"){
        return String(a.name||"").localeCompare(String(b.name||""), "ko");
      }
      // updatedAt/createdAt: ISO-like string comparable
      if(av === bv) return 0;
      return (av > bv) ? 1 : -1;
    }

    $("sortKey").addEventListener("change", ()=>{
      sortKey = $("sortKey").value;
      renderList();
    });
    $("sortDir").addEventListener("change", ()=>{
      sortDir = $("sortDir").value;
      renderList();
    });

    /* ========= create project ========= */
    function createProject(){
      if(!activeCat) return;
      const name = String($("newName").value||"").trim() || "NEW PROJECT";
      const folderName = $("folderSelect").value || "INBOX";

      const p = (activeCat==="logic") ? newLogic(name, folderName) : newArt(name, folderName);
      const arr = listRef(activeCat).slice();
      arr.unshift(p);
      setList(activeCat, arr);
      persist();
      $("newName").value = "";
      renderList();
      openDetail(activeCat, p.id);
    }

    $("createBtn").addEventListener("click", createProject);
    $("newName").addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){ e.preventDefault(); createProject(); }
    });

    /* ========= list render ========= */
    function renderList(){
      const cat = activeCat;
      if(!cat) return;

      const arr = listRef(cat).slice();
      const toolbar = $("listToolbar");
      const folderHead = $("folderHead");
      const listPanel = $("listPanel");

      if(arr.length === 0){
        // ✅ empty: remove right create area in toolbar (hide toolbar + folder controls)
        toolbar.style.display = "none";
        folderHead.style.display = "none";

        listPanel.innerHTML = `
          <div class="emptyCenter">
            <div class="emptyBox">
              <p>NO PROJECTS YET.</p>
              <div class="createRow">
                <input class="input" id="emptyNewName" type="text" maxlength="60" placeholder="+ NEW PROJECT" style="min-width:260px;" />
                <button class="btn ${cat==="logic" ? "logicAccent" : "artAccent"}" id="emptyCreateBtn" type="button">CREATE</button>
              </div>
            </div>
          </div>
        `;

        const en = listPanel.querySelector("#emptyNewName");
        const eb = listPanel.querySelector("#emptyCreateBtn");

        en.addEventListener("keydown", (e)=>{
          if(e.key === "Enter"){ e.preventDefault(); eb.click(); }
        });
        eb.addEventListener("click", ()=>{
          const name = String(en.value||"").trim() || "NEW PROJECT";
          const folderName = "INBOX";
          const p = (cat==="logic") ? newLogic(name, folderName) : newArt(name, folderName);
          const next = listRef(cat).slice();
          next.unshift(p);
          setList(cat, next);
          persist();

          // show controls back
          toolbar.style.display = "";
          folderHead.style.display = "";
          renderFolderSelect();
          renderList();
          openDetail(cat, p.id);
        });

        setTimeout(()=> en.focus(), 0);
        return;
      }

      // non-empty: show toolbar + folder controls
      toolbar.style.display = "";
      folderHead.style.display = "";

      // sort
      const sorted = arr.slice().sort((a,b)=>{
        const r = cmp(a,b, sortKey);
        return (sortDir === "asc") ? r : -r;
      });

      // group by folders
      const folderOrder = (cat==="logic") ? folders.logic.slice() : folders.art.slice();
      // include folders that exist in data but missing in folder list
      for(const p of sorted){
        const f = String(p.folder||"INBOX").toUpperCase();
        if(!folderOrder.includes(f)) folderOrder.push(f);
      }

      const blocks = [];
      for(const f of folderOrder){
        const list = sorted.filter(p => String(p.folder||"INBOX").toUpperCase() === f);
        if(!list.length) continue;
        blocks.push(`
          <div class="folderBlock">
            <div class="folderTitle">
              <strong>${escapeHtml(f)}</strong>
              <span class="count">${list.length}</span>
            </div>
            <div class="projList">
              ${list.map(p => `
                <button class="projRow" type="button" data-open="${p.id}">${escapeHtml(p.name||"PROJECT")}</button>
              `).join("")}
            </div>
          </div>
        `);
      }

      listPanel.innerHTML = blocks.join("");

      listPanel.querySelectorAll("[data-open]").forEach(btn=>{
        btn.addEventListener("click", ()=> openDetail(cat, btn.dataset.open));
      });
    }

    /* ========= undo delete ========= */
    function showUndoToast(msg, onUndo){
      const box = $("undoToast");
      $("undoMsg").textContent = msg;
      box.classList.add("open");

      const undoBtn = $("undoBtn");
      undoBtn.onclick = ()=>{
        box.classList.remove("open");
        onUndo && onUndo();
      };
    }

    function hideUndoToast(){
      $("undoToast").classList.remove("open");
      $("undoBtn").onclick = null;
    }

    function deleteWithUndo(cat, id){
      const arr = listRef(cat).slice();
      const idx = arr.findIndex(p => p.id === id);
      if(idx < 0) return;

      const item = arr[idx];
      arr.splice(idx,1);
      setList(cat, arr);
      persist();
      renderList();

      // clear previous pending
      if(pendingDelete && pendingDelete.timer){
        clearTimeout(pendingDelete.timer);
      }
      pendingDelete = { cat, item, index: idx, timer: null };

      showUndoToast("DELETED (3S)", ()=>{
        // undo
        const cur = listRef(cat).slice();
        const put = Math.max(0, Math.min(pendingDelete.index, cur.length));
        cur.splice(put, 0, pendingDelete.item);
        setList(cat, cur);
        persist();
        renderList();
        pendingDelete = null;
      });

      pendingDelete.timer = setTimeout(()=>{
        // commit
        hideUndoToast();
        pendingDelete = null;
      }, 3000);
    }

    /* ========= modal ========= */
    function openDetail(cat, id){
      const p = findProject(cat, id);
      if(!p) return;
      openId = id;

      $("overlay").classList.add("open");
      $("overlay").setAttribute("aria-hidden","false");

      $("mName").textContent = (p.name || "PROJECT").toUpperCase();
      const badge = $("mBadge");
      badge.textContent = (cat==="logic") ? "LOGIC" : "ART";
      badge.className = "badge " + cat;

      buildModalBody(cat, p);
    }

    function closeDetail(){
      $("overlay").classList.remove("open");
      $("overlay").setAttribute("aria-hidden","true");
      $("mBody").innerHTML = "";
      openId = null;
      isComposing = false;
      renderList(); // name 변경 반영
    }

    $("closeBtn").addEventListener("click", closeDetail);
    $("overlay").addEventListener("click", (e)=>{ if(e.target === $("overlay")) closeDetail(); });

    $("deleteBtn").addEventListener("click", ()=>{
      if(!activeCat || !openId) return;
      const id = openId;
      closeDetail();
      deleteWithUndo(activeCat, id);
    });

    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        if($("overlay").classList.contains("open")) closeDetail();
      }
    });

    function bindFieldIME(cat, id, el, applyFn, afterFn){
      el.addEventListener("compositionstart", ()=>{ isComposing = true; });
      el.addEventListener("compositionend", ()=>{
        isComposing = false;
        el.dispatchEvent(new Event("input", {bubbles:true}));
      });
      el.addEventListener("input", ()=>{
        if(isComposing) return;
        const v = el.value ?? "";
        updateProject(cat, id, pr=> applyFn(pr, v));
        if(typeof afterFn === "function") afterFn(v);
      });
    }

    function renderGalleryUI(cat, id, p){
      const wrap = $("galleryList");
      if(!wrap) return;

      const g = Array.isArray(p?.generation?.gallery) ? p.generation.gallery : [""];
      wrap.innerHTML = "";

      g.forEach((url, idx)=>{
        const row = document.createElement("div");
        row.className = "gRow";

        const thumb = document.createElement("div");
        thumb.className = "thumb";

        const u = String(url||"").trim();
        if(u){
          const img = document.createElement("img");
          img.src = u;
          img.alt = "";
          img.onerror = ()=>{
            thumb.innerHTML = `<div class="ph">NO IMG</div>`;
          };
          thumb.appendChild(img);
        }else{
          thumb.innerHTML = `<div class="ph">EMPTY</div>`;
        }

        const inp = document.createElement("input");
        inp.className = "tInput";
        inp.type = "text";
        inp.placeholder = "IMAGE URL…";
        inp.value = url || "";

        // IME safe
        inp.addEventListener("compositionstart", ()=>{ isComposing = true; });
        inp.addEventListener("compositionend", ()=>{
          isComposing = false;
          inp.dispatchEvent(new Event("input", {bubbles:true}));
        });
        inp.addEventListener("input", ()=>{
          if(isComposing) return;
          const v = inp.value || "";
          updateProject("art", id, pr=>{
            pr.generation = pr.generation || {};
            pr.generation.gallery = Array.isArray(pr.generation.gallery) ? pr.generation.gallery : [""];
            while(pr.generation.gallery.length <= idx) pr.generation.gallery.push("");
            pr.generation.gallery[idx] = v;
          });
          // re-render thumb minimally
          const np = findProject("art", id);
          renderGalleryUI("art", id, np);
        });

        const del = document.createElement("button");
        del.className = "btn danger";
        del.type = "button";
        del.textContent = "DEL";
        del.addEventListener("click", ()=>{
          updateProject("art", id, pr=>{
            pr.generation = pr.generation || {};
            pr.generation.gallery = Array.isArray(pr.generation.gallery) ? pr.generation.gallery : [""];
            pr.generation.gallery.splice(idx, 1);
            if(pr.generation.gallery.length === 0) pr.generation.gallery = [""];
          });
          const np = findProject("art", id);
          renderGalleryUI("art", id, np);
        });

        row.appendChild(thumb);
        row.appendChild(inp);
        row.appendChild(del);
        wrap.appendChild(row);
      });
    }

    function buildModalBody(cat, p){
      const body = $("mBody");
      body.innerHTML = "";

      // COMMON
      const common = document.createElement("div");
      common.className = "section";
      common.innerHTML = `
        <div class="secHead">
          <div class="secTitle">COMMON</div>
          <div class="secMeta" id="updatedMeta">UPDATED ${escapeHtml(p.updatedAt||"")}</div>
        </div>

        <div class="grid2">
          <div>
            <div class="label">PROJECT NAME</div>
            <input class="tInput" id="f_name" type="text" maxlength="60" />
          </div>
          <div>
            <div class="label">SUBTITLE</div>
            <input class="tInput" id="f_subtitle" type="text" maxlength="120" />
          </div>
        </div>

        <div class="grid2">
          <div>
            <div class="label">FOLDER</div>
            <select class="select" id="f_folder"></select>
          </div>
          <div>
            <div class="label"></div>
            <div style="font-size:11px; color: rgba(18,18,18,0.50); text-transform: uppercase; letter-spacing:0.2px; padding-top:10px;">
              (폴더별로 정리)
            </div>
          </div>
        </div>

        <div class="grid2">
          <div>
            <div class="label">OVERVIEW</div>
            <textarea class="tArea" id="f_overview" placeholder="개요…"></textarea>
          </div>
          <div>
            <div class="label">FEATURES</div>
            <textarea class="tArea" id="f_features" placeholder="기능…"></textarea>
          </div>
        </div>

        <div class="grid2">
          <div>
            <div class="label">REVISIONS</div>
            <textarea class="tArea" id="f_revisions" placeholder="수정사항…"></textarea>
            <div class="label" style="margin-top:10px;">REVISIONS — PROMPT (OPTIONAL)</div>
            <textarea class="tArea" id="f_revisions_prompt" placeholder="수정사항과 연결할 prompt 메모…"></textarea>
          </div>

          <div>
            <div class="label">ADDITIONS</div>
            <textarea class="tArea" id="f_additions" placeholder="추가항목…"></textarea>
            <div class="label" style="margin-top:10px;">ADDITIONS — PROMPT (OPTIONAL)</div>
            <textarea class="tArea" id="f_additions_prompt" placeholder="추가항목과 연결할 prompt 메모…"></textarea>
          </div>
        </div>
      `;
      body.appendChild(common);

      // category-specific
      if(cat === "logic"){
        const sec = document.createElement("div");
        sec.className = "section";
        sec.innerHTML = `
          <div class="secHead">
            <div class="secTitle">LOGIC</div>
            <div class="secMeta"></div>
          </div>

          <div class="grid2">
            <div>
              <div class="label">CATEGORY</div>
              <input class="tInput" id="f_category" type="text" maxlength="120" placeholder="EX) EMBEDDING WIDGET / DESKTOP OVERLAY" />
            </div>
            <div>
              <div class="label">TARGET</div>
              <input class="tInput" id="f_target" type="text" maxlength="120" placeholder="EX) SCHEDULER / TIME / WEATHER" />
            </div>
          </div>

          <div>
            <div class="label">LOGIC SHEET — SPEC</div>
            <textarea class="tArea" id="f_ls_spec" placeholder="SPEC…"></textarea>
          </div>

          <div>
            <div class="label">LOGIC SHEET — LOG</div>
            <textarea class="tArea" id="f_ls_log" placeholder="✅ FIXED / ⏳ DOING / ❗ ISSUE …"></textarea>
          </div>

          <div>
            <div class="label">PROMPT BANK</div>
            <textarea class="tArea" id="f_ls_prompt" placeholder="핵심 PROMPT / 메모…"></textarea>
          </div>
        `;
        body.appendChild(sec);
      }

      if(cat === "art"){
        const sec = document.createElement("div");
        sec.className = "section";
        sec.innerHTML = `
          <div class="secHead">
            <div class="secTitle">ART</div>
            <div class="secMeta"></div>
          </div>

          <div class="grid2">
            <div>
              <div class="label">ASSET GROUP</div>
              <input class="tInput" id="f_assetGroup" type="text" maxlength="140" placeholder="EX) BACKGROUND / COMPONENT STYLE / WORLD BUILD" />
            </div>
            <div>
              <div class="label">SEED</div>
              <input class="tInput" id="f_seed" type="text" maxlength="80" placeholder="SEED…" />
            </div>
          </div>

          <div class="grid2">
            <div>
              <div class="label">DESIGN TOKENS</div>
              <textarea class="tArea" id="f_designTokens" placeholder="토큰/규칙…"></textarea>
            </div>
            <div>
              <div class="label">PROMPT RECIPE</div>
              <textarea class="tArea" id="f_promptRecipe" placeholder="RECIPE…"></textarea>
            </div>
          </div>

          <div class="grid2">
            <div>
              <div class="label">CHECKPOINT</div>
              <input class="tInput" id="f_checkpoint" type="text" maxlength="140" placeholder="CHECKPOINT…" />
            </div>
            <div>
              <div class="label">LORA</div>
              <input class="tInput" id="f_lora" type="text" maxlength="140" placeholder="LORA…" />
            </div>
          </div>

          <div class="grid2">
            <div>
              <div class="label">SAMPLER</div>
              <input class="tInput" id="f_sampler" type="text" maxlength="80" placeholder="SAMPLER…" />
            </div>
            <div>
              <div class="label">GALLERY</div>
              <div style="display:flex; justify-content:flex-end; padding: 0 0 8px;">
                <button class="btn" id="galleryAddBtn" type="button">ADD</button>
              </div>
              <div id="galleryList"></div>
            </div>
          </div>

          <div class="grid2">
            <div>
              <div class="label">PROMPT</div>
              <textarea class="tArea" id="f_prompt" placeholder="PROMPT…"></textarea>
            </div>
            <div>
              <div class="label">NEGATIVE</div>
              <textarea class="tArea" id="f_negative" placeholder="NEGATIVE…"></textarea>
            </div>
          </div>
        `;
        body.appendChild(sec);
      }

      // PROGRESS (must be bottom)
      const progress = document.createElement("div");
      progress.className = "section";
      progress.innerHTML = `
        <div class="secHead">
          <div class="secTitle">PROGRESS</div>
          <div class="secMeta"></div>
        </div>

        <div class="tagRow" id="progressTags"></div>
        <div style="font-size:11px; color: rgba(18,18,18,0.50); text-transform: uppercase; letter-spacing:0.2px;">
          MULTI SELECT OK.
        </div>
      `;
      body.appendChild(progress);

      // set values
      const setVal = (id, v)=>{ const el = $(id); if(el) el.value = (v ?? ""); };

      setVal("f_name", p.name);
      setVal("f_subtitle", p.subtitle);

      setVal("f_overview", p.overview);
      setVal("f_features", p.features);
      setVal("f_revisions", p.revisions);
      setVal("f_revisions_prompt", p.revisionsPrompt);
      setVal("f_additions", p.additions);
      setVal("f_additions_prompt", p.additionsPrompt);

      // folder select
      const fsel = $("f_folder");
      const flist = (cat==="logic") ? folders.logic : folders.art;
      fsel.innerHTML = flist.map(f => `<option value="${escapeHtml(f)}">${escapeHtml(f)}</option>`).join("");
      fsel.value = String(p.folder||"INBOX").toUpperCase();
      fsel.addEventListener("change", ()=>{
        updateProject(cat, p.id, pr=> pr.folder = fsel.value);
        renderList();
      });

      if(cat==="logic"){
        setVal("f_category", p.category);
        setVal("f_target", p.target);
        setVal("f_ls_spec", p.logicSheet?.spec);
        setVal("f_ls_log", p.logicSheet?.log);
        setVal("f_ls_prompt", p.logicSheet?.promptBank);
      }
      if(cat==="art"){
        setVal("f_assetGroup", p.assetGroup);
        setVal("f_designTokens", p.designTokens);
        setVal("f_promptRecipe", p.promptRecipe);
        setVal("f_checkpoint", p.generation?.checkpoint);
        setVal("f_lora", p.generation?.lora);
        setVal("f_prompt", p.generation?.prompt);
        setVal("f_negative", p.generation?.negative);
        setVal("f_seed", p.generation?.seed);
        setVal("f_sampler", p.generation?.sampler);

        // gallery
        renderGalleryUI("art", p.id, p);
        $("galleryAddBtn").addEventListener("click", ()=>{
          updateProject("art", p.id, pr=>{
            pr.generation = pr.generation || {};
            pr.generation.gallery = Array.isArray(pr.generation.gallery) ? pr.generation.gallery : [""];
            pr.generation.gallery.push("");
          });
          const np = findProject("art", p.id);
          renderGalleryUI("art", p.id, np);
        });
      }

      // progress tag buttons
      const tagWrap = $("progressTags");
      const themeClass = (cat==="logic") ? "logic" : "art";
      const cur = Array.isArray(p.progressTags) ? p.progressTags : [];
      tagWrap.innerHTML = PROGRESS_TAGS.map(t=>{
        const on = cur.includes(t.key);
        return `<button class="tagBtn ${on ? `on ${themeClass}` : ""}" type="button" data-pt="${t.key}">${t.label}</button>`;
      }).join("");

      tagWrap.querySelectorAll("[data-pt]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const k = btn.dataset.pt;
          updateProject(cat, p.id, pr=>{
            pr.progressTags = Array.isArray(pr.progressTags) ? pr.progressTags : [];
            if(pr.progressTags.includes(k)) pr.progressTags = pr.progressTags.filter(x => x !== k);
            else pr.progressTags.push(k);
          });
          const np = findProject(cat, p.id);
          // update UI without full rebuild: toggle class/text quickly
          const now = Array.isArray(np.progressTags) ? np.progressTags : [];
          btn.className = "tagBtn" + (now.includes(k) ? ` on ${themeClass}` : "");
        });
      });

      // IME-safe binds (fix 2byte issue)
      bindFieldIME(cat, p.id, $("f_name"), (pr,v)=> pr.name = v, (v)=> $("mName").textContent = (v||"PROJECT").toUpperCase());
      bindFieldIME(cat, p.id, $("f_subtitle"), (pr,v)=> pr.subtitle = v);

      bindFieldIME(cat, p.id, $("f_overview"), (pr,v)=> pr.overview = v);
      bindFieldIME(cat, p.id, $("f_features"), (pr,v)=> pr.features = v);

      bindFieldIME(cat, p.id, $("f_revisions"), (pr,v)=> pr.revisions = v);
      bindFieldIME(cat, p.id, $("f_revisions_prompt"), (pr,v)=> pr.revisionsPrompt = v);

      bindFieldIME(cat, p.id, $("f_additions"), (pr,v)=> pr.additions = v);
      bindFieldIME(cat, p.id, $("f_additions_prompt"), (pr,v)=> pr.additionsPrompt = v);

      if(cat==="logic"){
        bindFieldIME("logic", p.id, $("f_category"), (pr,v)=> pr.category = v);
        bindFieldIME("logic", p.id, $("f_target"), (pr,v)=> pr.target = v);
        bindFieldIME("logic", p.id, $("f_ls_spec"), (pr,v)=> { pr.logicSheet=pr.logicSheet||{}; pr.logicSheet.spec=v; });
        bindFieldIME("logic", p.id, $("f_ls_log"), (pr,v)=> { pr.logicSheet=pr.logicSheet||{}; pr.logicSheet.log=v; });
        bindFieldIME("logic", p.id, $("f_ls_prompt"), (pr,v)=> { pr.logicSheet=pr.logicSheet||{}; pr.logicSheet.promptBank=v; });
      }

      if(cat==="art"){
        bindFieldIME("art", p.id, $("f_assetGroup"), (pr,v)=> pr.assetGroup = v);
        bindFieldIME("art", p.id, $("f_designTokens"), (pr,v)=> pr.designTokens = v);
        bindFieldIME("art", p.id, $("f_promptRecipe"), (pr,v)=> pr.promptRecipe = v);

        bindFieldIME("art", p.id, $("f_checkpoint"), (pr,v)=> { pr.generation=pr.generation||{}; pr.generation.checkpoint=v; });
        bindFieldIME("art", p.id, $("f_lora"), (pr,v)=> { pr.generation=pr.generation||{}; pr.generation.lora=v; });
        bindFieldIME("art", p.id, $("f_prompt"), (pr,v)=> { pr.generation=pr.generation||{}; pr.generation.prompt=v; });
        bindFieldIME("art", p.id, $("f_negative"), (pr,v)=> { pr.generation=pr.generation||{}; pr.generation.negative=v; });
        bindFieldIME("art", p.id, $("f_seed"), (pr,v)=> { pr.generation=pr.generation||{}; pr.generation.seed=v; });
        bindFieldIME("art", p.id, $("f_sampler"), (pr,v)=> { pr.generation=pr.generation||{}; pr.generation.sampler=v; });
      }
    }

    /* ========= HOME events ========= */
    $("pickLogic").addEventListener("click", ()=> setViewList("logic"));
    $("pickArt").addEventListener("click", ()=> setViewList("art"));
    $("pickLogic").addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setViewList("logic"); }});
    $("pickArt").addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setViewList("art"); }});

    /* ========= init ========= */
    renderTopbar();
  </script>
</body>
</html>
