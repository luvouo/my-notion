<!-- =========================
  3) UPCOMING WIDGET (FULL)
  - Pastel Blue (#daeffb)
  - Transparent background
  - Responsive
  - Stores list in localStorage
  - Optional date field (MM.DD)
========================= -->
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upcoming — Soft Schedule</title>

  <style>
    :root{
      --blue: rgba(218,239,251,0.92);     /* #daeffb */
      --border: rgba(218,239,251,0.62);
      --text: rgba(30,30,30,0.92);
      --muted: rgba(30,30,30,0.55);
      --glass: rgba(255,255,255,0.10);
      --glass-2: rgba(255,255,255,0.06);
      --shadow: 0 10px 30px rgba(0,0,0,0.06);
      --radius: 20px;
    }

    html, body{
      margin:0;
      padding:0;
      background: transparent;
      font-family: ui-sans-serif, system-ui, -apple-system,
        "Apple SD Gothic Neo","Noto Sans KR",sans-serif;
      color: var(--text);
    }

    .wrap{
      width: min(520px, 100%);
      margin: 0 auto;
      padding: clamp(10px, 2.6vw, 16px);
      box-sizing: border-box;
    }

    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: clamp(14px, 2.8vw, 18px);
      background: var(--glass);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(120% 80% at 0% 0%, rgba(218,239,251,0.25), transparent 55%),
        radial-gradient(80% 80% at 100% 20%, rgba(218,239,251,0.18), transparent 55%);
      pointer-events:none;
    }

    .inner{
      position: relative;
      z-index: 1;
      display: grid;
      gap: 12px;
    }

    .top{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
    }

    .title{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--blue);
      box-shadow: 0 0 0 6px rgba(218,239,251,0.22);
      flex: 0 0 auto;
    }

    h1{
      margin:0;
      font-size: clamp(14px, 3.6vw, 16px);
      letter-spacing: -0.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .meta{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }

    /* Input row: Date + Title + Add */
    .inputRow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .dateInput{
      flex: 0 0 auto;
      width: 92px;
      border: 1px solid rgba(218,239,251,0.55);
      background: rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 12px 12px;
      outline: none;
      color: var(--text);
      font-size: 13px;
      text-align: center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .textInput{
      flex: 1 1 220px;
      min-width: 0;
      border: 1px solid rgba(218,239,251,0.45);
      background: rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 12px 12px;
      outline: none;
      color: var(--text);
      font-size: 14px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .dateInput::placeholder,
    .textInput::placeholder{ color: rgba(30,30,30,0.45); }

    .btn{
      flex: 0 0 auto;
      border: 1px solid rgba(218,239,251,0.70);
      background: rgba(218,239,251,0.22);
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 13px;
      color: rgba(30,30,30,0.85);
      cursor: pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .btn:active{ transform: scale(0.98); }
    .btn:hover{ background: rgba(218,239,251,0.30); border-color: rgba(218,239,251,0.90); }

    .list{
      margin:0;
      padding:0;
      list-style:none;
      display:grid;
      gap: 8px;
    }

    .item{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(218,239,251,0.30);
      background: var(--glass-2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      min-width: 0;
    }

    .when{
      flex: 0 0 auto;
      font-size: 12px;
      color: rgba(30,30,30,0.70);
      border: 1px solid rgba(218,239,251,0.55);
      background: rgba(218,239,251,0.16);
      padding: 6px 8px;
      border-radius: 12px;
      line-height: 1;
      min-width: 56px;
      text-align: center;
    }

    .what{
      flex: 1 1 auto;
      min-width: 0;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .del{
      flex: 0 0 auto;
      border: none;
      background: transparent;
      color: rgba(30,30,30,0.55);
      cursor:pointer;
      font-size: 14px;
      padding: 6px 8px;
      border-radius: 10px;
      transition: background .2s ease, color .2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .del:hover{ background: rgba(0,0,0,0.05); color: rgba(30,30,30,0.75); }

    .footer{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 12px;
      color: var(--muted);
    }

    .linkBtn{
      border: 1px solid rgba(218,239,251,0.45);
      background: rgba(255,255,255,0.08);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      transition: background .2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .linkBtn:hover{ background: rgba(255,255,255,0.14); }

    @media (max-width: 360px){
      .meta{ display:none; }
      .btn{ width: 100%; }
      .textInput{ flex-basis: 100%; }
      .dateInput{ width: 100%; text-align:left; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Upcoming Widget">
      <div class="inner">
        <div class="top">
          <div class="title">
            <span class="dot" aria-hidden="true"></span>
            <h1>Upcoming</h1>
          </div>
          <div class="meta" id="metaText"></div>
        </div>

        <div class="inputRow">
          <input id="dateInput" class="dateInput" type="text" placeholder="MM.DD" inputmode="numeric" maxlength="5" />
          <input id="textInput" class="textInput" type="text" placeholder="가까운 일정 입력 (Enter)…" maxlength="80" />
          <button class="btn" id="addBtn" type="button">추가</button>
        </div>

        <ul class="list" id="list"></ul>

        <div class="footer">
          <span id="countText">0 items</span>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="linkBtn" id="sortBtn" type="button">날짜 정렬</button>
            <button class="linkBtn" id="resetBtn" type="button">전체 초기화</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function ymd(d=new Date()){
      const y=d.getFullYear();
      const m=String(d.getMonth()+1).padStart(2,"0");
      const day=String(d.getDate()).padStart(2,"0");
      return `${y}.${m}.${day}`;
    }
    const metaText = document.getElementById("metaText");
    metaText.textContent = ymd();

    const STORAGE_KEY = "soft_schedule_upcoming_v1";

    const listEl = document.getElementById("list");
    const dateEl = document.getElementById("dateInput");
    const textEl = document.getElementById("textInput");
    const addBtn = document.getElementById("addBtn");
    const countText = document.getElementById("countText");
    const sortBtn = document.getElementById("sortBtn");
    const resetBtn = document.getElementById("resetBtn");

    let state = loadState();

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      }catch(e){ return []; }
    }
    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function sanitizeDate(s){
      const t = (s || "").trim();
      // allow "", or "MM.DD"
      if(!t) return "";
      const m = t.match(/^(\d{1,2})\.(\d{1,2})$/);
      if(!m) return t.slice(0,5);
      const mm = String(Math.max(1, Math.min(12, Number(m[1])))).padStart(2,"0");
      const dd = String(Math.max(1, Math.min(31, Number(m[2])))).padStart(2,"0");
      return `${mm}.${dd}`;
    }

    function addItem(dateStr, text){
      const what = (text || "").trim();
      if(!what) return;
      const when = sanitizeDate(dateStr);
      state.unshift({
        id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()+Math.random())),
        when,
        what
      });
      saveState();
      render();
    }

    function deleteItem(id){
      state = state.filter(it => it.id !== id);
      saveState();
      render();
    }

    function sortByDate(){
      // Items without date go last; sort by MM.DD lexicographically
      state = [...state].sort((a,b)=>{
        const da = a.when || "99.99";
        const db = b.when || "99.99";
        if(da === db) return 0;
        return da < db ? -1 : 1;
      });
      saveState();
      render();
    }

    function resetAll(){
      state = [];
      saveState();
      render();
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m) => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#039;"
      }[m]));
    }

    function render(){
      listEl.innerHTML = "";
      for(const it of state){
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `
          <div class="when" title="날짜">${escapeHtml(it.when || "—")}</div>
          <div class="what" title="${escapeHtml(it.what)}">${escapeHtml(it.what)}</div>
          <button class="del" type="button" aria-label="삭제" data-del="${it.id}">✕</button>
        `;
        listEl.appendChild(li);
      }
      countText.textContent = `${state.length} items`;
    }

    function submit(){
      addItem(dateEl.value, textEl.value);
      textEl.value = "";
      textEl.focus();
    }

    addBtn.addEventListener("click", submit);

    textEl.addEventListener("keydown", (e) => {
      if(e.key === "Enter") submit();
    });

    dateEl.addEventListener("blur", () => {
      dateEl.value = sanitizeDate(dateEl.value);
    });

    // auto format while typing: 1231 -> 12.31
    dateEl.addEventListener("input", () => {
      const raw = dateEl.value.replace(/[^\d]/g, "").slice(0,4);
      if(raw.length >= 3){
        dateEl.value = raw.slice(0,2) + "." + raw.slice(2);
      }else{
        dateEl.value = raw;
      }
    });

    listEl.addEventListener("click", (e) => {
      const del = e.target.closest("[data-del]");
      if(del) deleteItem(del.dataset.del);
    });

    sortBtn.addEventListener("click", sortByDate);
    resetBtn.addEventListener("click", resetAll);

    // Seed once if empty
    if(state.length === 0){
      state = [
        { id: "u1", when: "01.30", what: "세탁기 수리" },
        { id: "u2", when: "02.01", what: "가족 모임" },
        { id: "u3", when: "02.03", what: "은행 방문" },
      ];
      saveState();
    }

    render();
  </script>
</body>
</html>

