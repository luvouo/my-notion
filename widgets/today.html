<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Today â€” Soft Schedule</title>

  <style>
    :root{
      /* Pastel Pink */
      --accent-1: rgba(255, 192, 203, 0.88);
      --accent-2: rgba(255, 170, 190, 0.55);
      --border: rgba(255, 170, 190, 0.62);

      --text: rgba(30,30,30,0.92);
      --muted: rgba(30,30,30,0.55);

      --glass: rgba(255,255,255,0.10);
      --glass-2: rgba(255,255,255,0.06);

      --shadow: 0 10px 30px rgba(0,0,0,0.06);
      --radius: 20px;
    }

    @font-face{
      font-family: "EnterSanChaek";
      src: url("../fonts/ì—”í„°ì‚°ì±…10.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    html, body{
      margin:0;
      padding:0;
      background: transparent;
      font-family: ui-sans-serif, system-ui, -apple-system,
        "Apple SD Gothic Neo","Noto Sans KR",sans-serif;
      color: var(--text);
    }

    .wrap{
      width: min(620px, 100%);
      margin: 0 auto;
      padding: clamp(10px, 2.6vw, 16px);
      box-sizing: border-box;
    }

    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: clamp(14px, 2.8vw, 18px);
      background: var(--glass);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden; /* ìœ ì§€ */
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(120% 80% at 0% 0%, rgba(255,192,203,0.25), transparent 55%),
        radial-gradient(80% 80% at 100% 20%, rgba(255,170,190,0.18), transparent 55%);
      pointer-events:none;
    }

    .inner{
      position: relative;
      z-index: 1;
      display: grid;
      gap: 12px;
    }

    .top{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .title{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .pearl{
      width: 18px;
      height: 18px;
      border-radius: 999px;
      display: block;
      object-fit: cover;
      flex: 0 0 auto;
      box-shadow: 0 0 0 2px rgba(255,192,203,0.22);
    }

    .title h1{
      margin:0;
      font-family: "EnterSanChaek", ui-sans-serif, system-ui, -apple-system,
        "Apple SD Gothic Neo","Noto Sans KR",sans-serif;
      font-size: clamp(15px, 3.8vw, 18px);
      letter-spacing: -0.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .meta{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      margin-left: auto;
    }

    .inputRow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .input{
      flex: 1 1 220px;
      min-width: 0;
      border: 1px solid rgba(255,170,190,0.45);
      background: rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 12px 12px;
      outline: none;
      color: var(--text);
      font-size: 14px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .input::placeholder{ color: rgba(30,30,30,0.45); }

    .btn{
      flex: 0 0 auto;
      border: 1px solid rgba(255,170,190,0.70);
      background: rgba(255,192,203,0.22);
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 13px;
      color: rgba(30,30,30,0.85);
      cursor: pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      white-space: nowrap;
    }
    .btn:active{ transform: scale(0.98); }
    .btn:hover{ background: rgba(255,192,203,0.30); border-color: rgba(255,170,190,0.90); }

    .btn.secondary{
      border: 1px solid rgba(255,170,190,0.45);
      background: rgba(255,255,255,0.08);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 12px;
    }
    .btn.secondary:disabled{
      opacity: 0.55;
      cursor: not-allowed;
    }

    .list{
      margin:0;
      padding:0;
      list-style:none;
      display:grid;
      gap: 8px;
    }

    .item{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 12px 10px;   /* âœ… ê¸°ì¡´ 10px 10px â†’ ì…ë ¥ì°½(12px)ê³¼ í†µì¼ */
      min-height: 44px;     /* âœ… ì…ë ¥ì°½ ì²´ê° ë†’ì´ì™€ ë§ì¶”ê¸° */
      border-radius: 14px;
      border: 1px solid rgba(255,170,190,0.30);
      background: var(--glass-2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      min-width: 0;
    }

    .check{
      width: 18px;
      height: 18px;
      border-radius: 6px;
      border: 1.6px solid rgba(255,170,190,0.95);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .check svg{
      width: 12px;
      height: 12px;
      opacity: 0;
      transform: scale(0.9);
      transition: opacity .18s ease, transform .18s ease;
    }

    .text{
      flex: 1 1 auto;
      min-width: 0;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .del{
      flex: 0 0 auto;
      border: none;
      background: transparent;
      color: rgba(30,30,30,0.55);
      cursor:pointer;
      font-size: 14px;
      padding: 6px 8px;
      border-radius: 10px;
      transition: background .2s ease, color .2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .del:hover{ background: rgba(0,0,0,0.05); color: rgba(30,30,30,0.75); }

    .item.done{ opacity: 0.78; }
    .item.done .text{ text-decoration: line-through; color: rgba(30,30,30,0.50); }
    .item.done .check{
      background: rgba(255,192,203,0.25);
      border-color: rgba(255,170,190,1);
    }
    .item.done .check svg{ opacity: 1; transform: scale(1); }

    .footer{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 12px;
      color: var(--muted);
    }

    .toast{
      font-size: 12px;
      color: rgba(30,30,30,0.65);
      min-height: 16px;
    }

    /* âœ… bottom buttons: right aligned + horizontal scroll on narrow screens */
    .footer-actions{
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 8px;
      width: 100%;

      flex-wrap: nowrap;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;

      margin-left: auto;
      padding-left: 8px;
      padding-right: 2px;

      scrollbar-width: none;
    }
    .footer-actions::-webkit-scrollbar{ display: none; }
    .footer-actions > .btn{ flex: 0 0 auto; }

    /* âœ… hide non-essential buttons (kept in DOM but removed from layout) */
    #clearDoneBtn,
    #resetBtn{
      display: none !important;
      width: 0 !important;
      height: 0 !important;
      padding: 0 !important;
      margin: 0 !important;
      border: 0 !important;
    }

    /* âœ… bottom action buttons font */
    #carryYesterdayBtn,
    #historyBtn,
    #copyTodayBtn{
      font-family: "EnterSanChaek", ui-sans-serif, system-ui, -apple-system,
        "Apple SD Gothic Neo","Noto Sans KR",sans-serif;
      transition:
        color .18s ease,
        border-color .18s ease,
        box-shadow .18s ease,
        background .18s ease,
        transform .08s ease;
    }

    /* âœ… footer 3 buttons hover -> accent color */
    #carryYesterdayBtn:hover,
    #historyBtn:hover,
    #copyTodayBtn:hover{
      color: var(--accent-1);                 /* âœ… í…ìŠ¤íŠ¸ë§Œ í¬ì¸íŠ¸ */
      background: rgba(255,255,255,0.08);     /* âœ… ê±°ì˜ ë³€í™” ì—†ìŒ(ë¯¸ë‹ˆë©€) */
      border-color: rgba(255,170,190,0.70);   /* âœ… ì‚´ì§ë§Œ ê°•ì¡° */
      box-shadow: 0 0 0 3px rgba(255,192,203,0.22);  /* âœ… ì¤‘ê°„ ê°•ë„ ë§ */
    }

    /* âœ… keyboard focus: match hover tone (medium) */
    #carryYesterdayBtn:focus-visible,
    #historyBtn:focus-visible,
    #copyTodayBtn:focus-visible{
      outline: none;                           /* ê¸°ë³¸ íŒŒë€ outline ì œê±° */
      color: var(--accent-1);
      background: rgba(255,255,255,0.08);
      border-color: rgba(255,170,190,0.78);
      box-shadow: 0 0 0 3px rgba(255,192,203,0.28);
    }


    
        /* ì„ íƒ ë‚ ì§œ ì•¡ì…˜ ë²„íŠ¼ì„ ë” ì‘ê³  ì •ëˆëœ pillë¡œ */
    #carryPickedBtn,
    #copyPickedBtn{
      padding: 9px 10px;
      border-radius: 999px;
      font-size: 12px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      gap: 6px;              /* ì•„ì´ì½˜-í…ìŠ¤íŠ¸ ê°„ê²© */
      letter-spacing: -0.1px;
    }

       #addBtn{
      /* ğŸ”¹ ë°˜ì‘í˜• í¬ê¸° */
      height: clamp(28px, 3.2vw, 32px);
      min-width: clamp(28px, 3.2vw, 32px);
    
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: 4px; /* âœ… ìœ„ì¹˜ ì‚´ì§ ì•„ë˜ë¡œ */
    
      /* ğŸ”¹ SVG ì»¬ëŸ¬ */
      color: #F2C6D8; /* ê±°ì˜ í° í•‘í¬ */
    
      background: #FFFBFD; /* ê±°ì˜ í° ë°°ê²½ */
      border: 1px solid #F3D3E2;
      border-radius: 999px;
    
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      cursor: pointer;
    
      transition:
        box-shadow 0.2s ease,
        border-color 0.2s ease,
        background 0.2s ease,
        transform 0.15s ease;
    }

    #addBtn:focus-visible{
      outline: none;
      background: transparent;
      border-color: rgba(255,170,190,0.78);
      box-shadow: 0 0 0 3px rgba(255,192,203,0.28); /* âœ… ì¤‘ê°„ ê°•ë„ */
    }

    
    /* ğŸ”¹ hover: ë°°ê²½ ì œê±° + ë§ë§Œ */
    #addBtn:hover{
      background: transparent;
      border-color: #EFC7D9;
      box-shadow: 0 0 0 3px rgba(242,198,216,0.25);
    }
    
    /* ğŸ”¹ active */
    #addBtn:active{
      transform: scale(0.96);
    }
    
    /* ğŸ”¹ disabled */
    #addBtn:disabled{
      opacity: 0.45;
      cursor: not-allowed;
      background: transparent;
      border-color: rgba(239,199,217,0.35);
      box-shadow: none;
      transform: none;
    }
    
    #addBtn:disabled:hover{
      background: transparent;
      box-shadow: none;
    }

        
    /* -------- Modal -------- */
    .modalOverlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.18);
    
      display: none;
      align-items: center;
      justify-content: center;
    
      padding: 10px;               /* ê¸°ì¡´ 18px â†’ ì¤„ì—¬ì„œ ê³µê°„ í™•ë³´ */
      z-index: 5000;
    
      overflow: hidden;            /* overlay ìì²´ëŠ” ìŠ¤í¬ë¡¤ X */
    }
    .modalOverlay.open{ display:flex; }


    .modal{
      width: min(820px, 100%);
      max-height: calc(100vh - 20px); /* âœ… iframe/ë·°í¬íŠ¸ ë‚´ì—ì„œ ìµœëŒ€ ë†’ì´ */
      display: flex;                  /* âœ… í—¤ë”/ë°”ë””/í‘¸í„° ë ˆì´ì•„ì›ƒ ê³ ì • */
      flex-direction: column;
      border-radius: 18px;
      border: 1px solid rgba(255,170,190,0.38);
      background: rgba(255,255,255,0.82);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0,0,0,0.18);
      overflow: hidden;
    }

    .modalHeader{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
      flex-wrap: wrap;
    }

    .mhLeft{
      display:flex;
      gap: 10px;
      align-items:center;
      min-width: 0;
    }
    .mhLeft strong{
      font-size: 14px;
      letter-spacing: -0.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .mhRight{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: flex-end;
      flex: 1 1 auto;
    }

    .search{
      border: 1px solid rgba(0,0,0,0.08);
      background: rgba(255,255,255,0.70);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 12.5px;
      outline: none;
      min-width: min(340px, 100%);
    }
    .search::placeholder{ color: rgba(30,30,30,0.45); }

    .modalBody{
      display: grid;
      grid-template-columns: max-content 1fr; /* âœ… ì™¼ìª½: ë‚´ìš©ë§Œí¼ */
    
      min-height: 0;                 /* âœ… ì¤‘ìš”: ìì‹ overflow ì‘ë™ ì¡°ê±´ */
      flex: 1 1 auto;                /* âœ… ë‚¨ëŠ” ì˜ì—­ì„ ë°”ë””ê°€ ì°¨ì§€ */
      overflow: hidden;              /* âœ… íŒ¨ë„ë“¤ì´ ìŠ¤í¬ë¡¤ */
    }


    .dates{
      border-right: 1px solid rgba(0,0,0,0.06);
      padding: 12px 10px;
      overflow: auto;
    
      width: max-content;       /* âœ… íŒ¨ë„ ìì²´ë„ ë‚´ìš©ë§Œí¼ */
      max-width: none;          /* âœ… ìƒí•œ ì œê±° */
      min-width: unset;         /* âœ… í•˜í•œ ì œê±° */
      min-height: 0;

      justify-items: start;
    }


    .dateBtn{
      width: fit-content;
      max-width: 100%;
      display: grid;
      gap: 4px;
    
      padding: 8px 10px;
      margin-bottom: 10px;
    
      border-radius: 14px;
      border: 1px solid rgba(255,170,190,0.22);
      background: rgba(255,255,255,0.62);
    
      cursor: pointer;
      text-align: left;
      white-space: nowrap;
    
      font-size: 13px;
      color: rgba(30,30,30,0.88);
    
      transition: background .18s ease, border-color .18s ease, transform .08s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .dateBtn:hover{
      border-color: rgba(255,170,190,0.45);
      background: rgba(255,255,255,0.72);
    }
    .dateBtn:active{
      transform: scale(0.99);
    }
    
    .dateBtn small{
      display: block;
      font-size: 11px;
      color: rgba(30,30,30,0.52);
      margin-top: 0;
    }
    
    .dateBtn.active{
      border-color: rgba(255,170,190,0.70);
      background: rgba(255,192,203,0.14);
      box-shadow: 0 10px 26px rgba(255,170,190,0.12);
    }


    .preview{
      padding: 12px;
      overflow: auto;
      min-height: 0;                 /* âœ… ì¤‘ìš” */
      display: grid;
      gap: 10px;
    }

    .previewTop{
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: nowrap;       /* âœ… ê¸°ë³¸ì€ í•œ ì¤„ ìœ ì§€ */
      min-width: 0;
    }
    
    .picked{
      font-size: 13px;
      color: rgba(30,30,30,0.82);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis; /* âœ… ê¸¸ë©´ ë§ì¤„ì„ */
      min-width: 0;
      flex: 1 1 auto;
    }

        /* ë²„íŠ¼ 2ê°œ ë˜í¼(HTMLì— ì¸ë¼ì¸ styleë¡œ ë˜ì–´ìˆë˜ ë¶€ë¶„ì„ classë¡œ ë°”ê¾¸ëŠ” ê²Œ ë² ìŠ¤íŠ¸ì§€ë§Œ,
       ì§€ê¸ˆ êµ¬ì¡° ê·¸ëŒ€ë¡œ ì“¸ ìˆ˜ ìˆê²Œ "previewTop ì•ˆì˜ ë²„íŠ¼ ê·¸ë£¹"ì„ íƒ€ê²ŸíŒ… */
    .previewTop > div:last-child{
      display:flex;
      gap: 8px;
      flex-wrap: nowrap;
      justify-content: flex-end;
      flex: 0 0 auto;
    }

    
    .previewBox{
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,0.66);
      display: grid;
      gap: 10px;
    }

    .pItem{
      display:flex;
      gap: 10px;
      align-items:center;
      font-size: 13px;
      color: rgba(30,30,30,0.86);
      line-height: 1.25;
    }
    .badge{
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      background: rgba(0,0,0,0.03);
      color: rgba(30,30,30,0.58);
      flex: 0 0 auto;
    }
    .badge.done{
      border-color: rgba(255,170,190,0.40);
      background: rgba(255,192,203,0.18);
      color: rgba(30,30,30,0.62);
    }

    .mark{
      background: rgba(255,192,203,0.35);
      border-radius: 6px;
      padding: 0 3px;
    }

    .modalFooter{
      padding: 12px 14px;
      border-top: 1px solid rgba(0,0,0,0.06);
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      font-size: 12px;
      color: rgba(30,30,30,0.55);
    }

    @media (max-width: 420px){
      .modalBody{ grid-template-columns: 1fr; }
      .dates{ border-right: none; border-bottom: 1px solid rgba(0,0,0,0.06); }
      .search{ min-width: 100%; }
    }


    @media (max-width: 360px){
      .meta{ display:none; }
      .btn{ width: 100%; }
      .input{ flex-basis: 100%; }
    }

    /* âœ… Copy Popover (fixed, no overflow clipping) */
    .popover{
      position: fixed;
      left: 0;
      top: 0;
      min-width: 150px;
      padding: 6px;
      border-radius: 14px;
      border: 1px solid rgba(255,170,190,0.38);
      background: rgba(255,255,255,0.86);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.12);
      z-index: 9999;

      opacity: 0;
      pointer-events: none;
      transform: translateY(6px);
      transition: opacity .14s ease, transform .14s ease;
    }
    .popover.open{
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .popItem{
      width: 100%;
      text-align: left;
      border: 1px solid rgba(0,0,0,0.06);
      background: rgba(255,255,255,0.70);
      border-radius: 12px;
      padding: 10px 10px;
      font-size: 12.5px;
      color: rgba(30,30,30,0.82);
      cursor: pointer;
      font-family: "EnterSanChaek", ui-sans-serif, system-ui, -apple-system,
        "Apple SD Gothic Neo","Noto Sans KR",sans-serif;
    }
    .popItem:hover{
      border-color: rgba(255,170,190,0.55);
      background: rgba(255,192,203,0.14);
    }

        /* Fix: Notion embed flex/min-width clipping */
    .modalHeader, .mhRight, .mhLeft{
      min-width: 0;
    }
    
    .modalHeader{
      box-sizing: border-box;
    }
    
    .mhRight{
      flex: 1 1 360px;   /* ê²€ìƒ‰ì´ ìš°ì„ ì ìœ¼ë¡œ ê³µê°„ í™•ë³´ */
      min-width: 0;
    }
    
    .search{
      flex: 1 1 260px;   /* âœ… ì¤„ì–´ë“¤ ìˆ˜ ìˆê²Œ */
      min-width: 0;      /* âœ… ì˜ë¦¼ ë°©ì§€ í•µì‹¬ */
      width: 100%;
      box-sizing: border-box;
    }

       
    @media (pointer: coarse){
      #addBtn{
        position: relative;
      }
      #addBtn::after{
        content:"";
        position:absolute;
        inset:-6px;               /* í„°ì¹˜ íˆíŠ¸ë°•ìŠ¤ë§Œ í™•ëŒ€ */
      }
    }

    
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Today Widget">
      <div class="inner">
        <div class="top">
          <div class="title">
            <img class="pearl" src="./icon/pearl.png" alt="" aria-hidden="true" />
            <h1>Today</h1>
          </div>
          <div class="meta" id="metaText"></div>
        </div>

        <div class="inputRow">
          <input id="todoInput" class="input" type="text" placeholder="ì˜¤ëŠ˜ í•  ì¼ (Enter)â€¦" maxlength="80" />
          <button class="btn" id="addBtn" type="button" title="í•  ì¼ ì¶”ê°€" aria-label="í•  ì¼ ì¶”ê°€"></button>
        </div>

        <ul class="list" id="list"></ul>

        <div class="footer">
          <span id="countText">0/0 done</span>

          <div class="footer-actions">
            <button class="btn secondary" id="carryYesterdayBtn" type="button">Carry over</button>
            <button class="btn secondary" id="historyBtn" type="button">History / Archive</button>
            <button class="btn secondary" id="copyTodayBtn" type="button">Copy</button>

            <!-- kept but hidden -->
            <button class="btn secondary" id="clearDoneBtn" type="button">ì™„ë£Œ ì‚­ì œ</button>
            <button class="btn secondary" id="resetBtn" type="button">ì „ì²´ ì´ˆê¸°í™”</button>
          </div>
        </div>

        <div class="toast" id="toast"></div>
      </div>
    </div>
  </div>

  <!-- âœ… Copy Popover (placed at body level; fixed positioning) -->
  <div class="popover" id="copyPopover" aria-hidden="true">
    <button class="popItem" type="button" data-copy="all">All</button>
    <button class="popItem" type="button" data-copy="todo">Todo</button>
    <button class="popItem" type="button" data-copy="done">Done</button>
  </div>

  <!-- History / Archive Modal -->
  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="History / Archive">
      <div class="modalHeader">
        <div class="mhLeft">
          <img class="pearl" src="./icon/pearl.png" alt="" aria-hidden="true" />
          <strong>History / Archive</strong>
        </div>

        <div class="mhRight">
          <input id="searchInput" class="search" type="text" placeholder="ê²€ìƒ‰: ë‚ ì§œ(YYYY.MM.DD) ë˜ëŠ” í•  ì¼ í‚¤ì›Œë“œâ€¦" />
          <button class="btn secondary" id="clearSearchBtn" type="button">ê²€ìƒ‰ ì´ˆê¸°í™”</button>
          <button class="btn secondary" id="closeModalBtn" type="button">ë‹«ê¸°</button>
        </div>
      </div>

      <div class="modalBody">
        <div class="dates" id="datesPanel"></div>

        <div class="preview">
          <div class="previewTop">
            <div class="picked" id="pickedDateText">ë‚ ì§œë¥¼ ì„ íƒí•´ì¤˜</div>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn secondary" id="carryPickedBtn" type="button" disabled>Carry</button>
              <button class="btn secondary" id="copyPickedBtn" type="button" disabled>Copy</button>
            </div>
          </div>

          <div class="previewBox" id="previewBox">
            <div style="color: rgba(30,30,30,0.55); font-size:12px;">
              ì™¼ìª½ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´, ê·¸ë‚ ì˜ Today ê¸°ë¡ì„ ë³´ì—¬ì¤˜.
            </div>
          </div>
        </div>
      </div>

      <div class="modalFooter">
        <span id="archiveMeta">ìë™ ì•„ì¹´ì´ë¸Œ: ON (ê¸°ê°„ ì œí•œ ì—†ìŒ)</span>
        <span id="archiveCount">0 days archived</span>
      </div>
    </div>
  </div>

  <script>
    const PREFIX_DAY = "soft_schedule_today_";
    const KEY_ARCHIVE = "soft_schedule_today_archive_v1";

    function formatDateLabel(dateStr){
      const d = ymdToDate(dateStr);
      if(!d) return dateStr;
    
      const yy = String(d.getFullYear()).slice(-2);
      const mm = pad2(d.getMonth() + 1);
      const dd = pad2(d.getDate());
      const wk = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][d.getDay()];
    
      return `${yy}.${mm}.${dd} (${wk})`;
    }

    function pad2(n){ return String(n).padStart(2,"0"); }
    function ymd(d=new Date()){
      return `${d.getFullYear()}.${pad2(d.getMonth()+1)}.${pad2(d.getDate())}`;
    }
    function parseYmd(str){
      const m = /^(\d{4})\.(\d{2})\.(\d{2})$/.exec(str);
      if(!m) return null;
      return { y:+m[1], m:+m[2], d:+m[3] };
    }
    function ymdToDate(str){
      const p = parseYmd(str);
      if(!p) return null;
      return new Date(p.y, p.m-1, p.d);
    }
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m) => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#039;"
      }[m]));
    }
    function showToast(msg){
      toast.textContent = msg;
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.textContent = "", 1600);
    }
    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        try{
          const ok = document.execCommand("copy");
          document.body.removeChild(ta);
          return ok;
        }catch(err){
          document.body.removeChild(ta);
          return false;
        }
      }
    }
    function formatForCopy(dateStr, items){
      const lines = [];
      lines.push(`[Today | ${dateStr}]`);
      for(const it of items){
        lines.push(`- [${it.done ? "x" : " "}] ${it.text}`);
      }
      return lines.join("\n");
    }
    function highlight(text, query){
      const t = String(text);
      const q = String(query || "").trim();
      if(!q) return escapeHtml(t);
      const idx = t.toLowerCase().indexOf(q.toLowerCase());
      if(idx === -1) return escapeHtml(t);
      const before = escapeHtml(t.slice(0, idx));
      const mid = escapeHtml(t.slice(idx, idx + q.length));
      const after = escapeHtml(t.slice(idx + q.length));
      return `${before}<span class="mark">${mid}</span>${after}`;
    }

    function loadArchive(){
      try{
        const raw = localStorage.getItem(KEY_ARCHIVE);
        if(!raw) return {};
        const parsed = JSON.parse(raw);
        return (parsed && typeof parsed === "object") ? parsed : {};
      }catch(e){ return {}; }
    }
    function saveArchive(archive){
      localStorage.setItem(KEY_ARCHIVE, JSON.stringify(archive));
    }

    function autoArchivePastDays(todayStr){
      const archive = loadArchive();
      const keys = [];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(!k) continue;
        if(k === KEY_ARCHIVE) continue;
        if(!k.startsWith(PREFIX_DAY)) continue;
        const dateStr = k.slice(PREFIX_DAY.length);
        if(dateStr === todayStr) continue;
        if(!parseYmd(dateStr)) continue;
        keys.push({ k, dateStr });
      }

      let moved = 0;
      for(const {k, dateStr} of keys){
        if(archive[dateStr]){
          try{ localStorage.removeItem(k); }catch(e){}
          continue;
        }
        try{
          const raw = localStorage.getItem(k);
          const items = raw ? JSON.parse(raw) : null;
          if(Array.isArray(items)){
            archive[dateStr] = items;
            moved++;
          }
          localStorage.removeItem(k);
        }catch(e){}
      }

      if(moved > 0) saveArchive(archive);
      return archive;
    }

    const todayStr = ymd(new Date());
    const yesterdayStr = ymd(new Date(Date.now() - 86400000));
    const KEY_TODAY = `${PREFIX_DAY}${todayStr}`;

    // Main
    const metaText = document.getElementById("metaText");
    const listEl = document.getElementById("list");
    const inputEl = document.getElementById("todoInput");
    const addBtn = document.getElementById("addBtn");
    
              /* âœ… ì—¬ê¸° ë°”ë¡œ ì•„ë˜ì— ì¶”ê°€ */
          addBtn.innerHTML = `
          <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
            <path d="M12 5v14M5 12h14"
                  stroke="currentColor"
                  stroke-width="1.6"
                  stroke-linecap="round"/>
          </svg>
          `;
          
      
    
    const countText = document.getElementById("countText");
    const clearDoneBtn = document.getElementById("clearDoneBtn");
    const resetBtn = document.getElementById("resetBtn");

    const carryYesterdayBtn = document.getElementById("carryYesterdayBtn");
    const historyBtn = document.getElementById("historyBtn");
    const copyTodayBtn = document.getElementById("copyTodayBtn");
    const copyPopover = document.getElementById("copyPopover");

    const toast = document.getElementById("toast");

    // ===== Add button enable/disable sync =====
    function syncAddButtonState(){
      const hasText = (inputEl.value || "").trim().length > 0;
      addBtn.disabled = !hasText;
    }
    
    inputEl.addEventListener("input", syncAddButtonState);
    syncAddButtonState(); // ì´ˆê¸° 1íšŒ


    // Modal
    const modalOverlay = document.getElementById("modalOverlay");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const datesPanel = document.getElementById("datesPanel");
    const pickedDateText = document.getElementById("pickedDateText");
    const previewBox = document.getElementById("previewBox");
    const copyPickedBtn = document.getElementById("copyPickedBtn");
    const carryPickedBtn = document.getElementById("carryPickedBtn");
    const archiveCount = document.getElementById("archiveCount");
    const searchInput = document.getElementById("searchInput");
    const clearSearchBtn = document.getElementById("clearSearchBtn");

    metaText.textContent = todayStr;

    let archive = autoArchivePastDays(todayStr);
    let state = loadDay(KEY_TODAY);
    let pickedDate = null;
    let searchQuery = "";

    function loadDay(key){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      }catch(e){ return []; }
    }
    function saveDay(key, items){
      localStorage.setItem(key, JSON.stringify(items));
    }

    function addItem(text){
      const t = (text || "").trim();
      if(!t) return;
      state.unshift({
        id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()+Math.random())),
        text: t,
        done: false
      });
      saveDay(KEY_TODAY, state);
      render();
    }
    function toggleItem(id){
      state = state.map(it => it.id === id ? ({ ...it, done: !it.done }) : it);
      saveDay(KEY_TODAY, state);
      render();
    }
    function deleteItem(id){
      state = state.filter(it => it.id !== id);
      saveDay(KEY_TODAY, state);
      render();
    }
    function clearDone(){
      state = state.filter(it => !it.done);
      saveDay(KEY_TODAY, state);
      render();
    }
    function resetAll(){
      state = [];
      saveDay(KEY_TODAY, state);
      render();
    }

    function render(){
      listEl.innerHTML = "";
      for(const it of state){
        const li = document.createElement("li");
        li.className = "item" + (it.done ? " done" : "");
        li.innerHTML = `
          <div class="check" role="checkbox" aria-checked="${it.done}" tabindex="0" data-id="${it.id}">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M20 7L10 17l-5-5" stroke="rgba(30,30,30,0.85)" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="text" title="${escapeHtml(it.text)}">${escapeHtml(it.text)}</div>
          <button class="del" type="button" aria-label="ì‚­ì œ" data-del="${it.id}">âœ•</button>
        `;
        listEl.appendChild(li);
      }
      const total = state.length;
      const done = state.filter(x => x.done).length;
      countText.textContent = `${done}/${total} done`;
    }

    function carryOverUnfinishedFromDate(dateStr){
      if(!dateStr || !parseYmd(dateStr)){
        showToast("ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ë‚ ì§œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„.");
        return;
      }
      const src = archive[dateStr];
      if(!src || !Array.isArray(src) || src.length === 0){
        showToast("ê°€ì ¸ì˜¬ ê¸°ë¡ì´ ì—†ì–´.");
        return;
      }

      const unfinished = src.filter(x => !x.done && (x.text || "").trim());
      if(unfinished.length === 0){
        showToast("ë¯¸ì™„ë£Œê°€ ì—†ì–´.");
        return;
      }

      const existing = new Set(state.map(x => (x.text || "").trim()));
      const toAdd = [];
      for(const it of unfinished){
        const tx = (it.text || "").trim();
        if(!tx) continue;
        if(existing.has(tx)) continue;
        toAdd.push({
          id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()+Math.random())),
          text: tx,
          done: false
        });
      }

      if(toAdd.length === 0){
        showToast("ë¯¸ì™„ë£Œê°€ ì´ë¯¸ ì˜¤ëŠ˜ì— ìˆì–´.");
        return;
      }

      state = [...toAdd, ...state];
      saveDay(KEY_TODAY, state);
      render();
      showToast(`${dateStr} ë¯¸ì™„ë£Œ ${toAdd.length}ê°œ ê°€ì ¸ì™”ì–´.`);
    }

    function carryOverYesterday(){
      if(archive[yesterdayStr]) return carryOverUnfinishedFromDate(yesterdayStr);

      const raw = localStorage.getItem(`${PREFIX_DAY}${yesterdayStr}`);
      if(!raw){
        showToast("ì–´ì œ ê¸°ë¡ì´ ì—†ì–´.");
        return;
      }
      try{
        const items = JSON.parse(raw);
        if(Array.isArray(items)){
          archive[yesterdayStr] = items;
          saveArchive(archive);
          try{ localStorage.removeItem(`${PREFIX_DAY}${yesterdayStr}`);}catch(e){}
          carryOverUnfinishedFromDate(yesterdayStr);
        }else{
          showToast("ì–´ì œ ê¸°ë¡ì„ ì½ì„ ìˆ˜ ì—†ì–´.");
        }
      }catch(e){
        showToast("ì–´ì œ ê¸°ë¡ì„ ì½ì„ ìˆ˜ ì—†ì–´.");
      }
    }

    async function copyToday(mode = "all"){
      let filtered = state;
      if(mode === "todo") filtered = state.filter(x => !x.done);
      if(mode === "done") filtered = state.filter(x => x.done);

      const text = formatForCopy(todayStr, filtered);
      const ok = await copyToClipboard(text);

      const label =
        mode === "todo" ? "ë¯¸ì™„ë£Œë§Œ" :
        mode === "done" ? "ì™„ë£Œë§Œ" : "ì „ì²´";

      showToast(ok ? `${label} ë³µì‚¬í–ˆì–´.` : "ë³µì‚¬ ì‹¤íŒ¨ (ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)");
    }

    async function copyPicked(){
      if(!pickedDate) return;
      const items = archive[pickedDate] || [];
      const text = formatForCopy(pickedDate, items);
      const ok = await copyToClipboard(text);
      showToast(ok ? "ì„ íƒ ë‚ ì§œ ê¸°ë¡ì„ ë³µì‚¬í–ˆì–´." : "ë³µì‚¬ ì‹¤íŒ¨ (ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)");
    }

    function openModal(){
      archive = loadArchive();
      searchQuery = (searchInput.value || "").trim();
      buildDates();
      modalOverlay.classList.add("open");
      modalOverlay.setAttribute("aria-hidden", "false");

      pickedDate = null;
      pickedDateText.textContent = "ë‚ ì§œë¥¼ ì„ íƒí•´ì¤˜";
      copyPickedBtn.disabled = true;
      carryPickedBtn.disabled = true;
      previewBox.innerHTML = `
        <div style="color: rgba(30,30,30,0.55); font-size:12px;">
          ì™¼ìª½ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´, ê·¸ë‚ ì˜ Today ê¸°ë¡ì„ ë³´ì—¬ì¤˜.
        </div>
      `;
    }

    function closeModal(){
      modalOverlay.classList.remove("open");
      modalOverlay.setAttribute("aria-hidden", "true");
    }

    function dateMatchesQuery(dateStr, items, q){
      if(!q) return true;
      const lowerQ = q.toLowerCase();
      if(dateStr.toLowerCase().includes(lowerQ)) return true;
      for(const it of (items || [])){
        const tx = String(it.text || "").toLowerCase();
        if(tx.includes(lowerQ)) return true;
      }
      return false;
    }

    function buildDates(){
      const q = (searchQuery || "").trim();
      const dates = Object.keys(archive).filter(d => parseYmd(d));
      dates.sort((a,b) => ymdToDate(b).getTime() - ymdToDate(a).getTime());

      const filtered = dates.filter(d => dateMatchesQuery(d, archive[d], q));

      datesPanel.innerHTML = "";
      if(filtered.length === 0){
        datesPanel.innerHTML = `
          <div style="color: rgba(30,30,30,0.55); font-size:12px; padding:8px;">
            ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´.
          </div>
        `;
      }else{
        for(const d of filtered){
          const items = archive[d] || [];
          const done = items.filter(x => x.done).length;
          const total = items.length;

          const btn = document.createElement("button");
          btn.className = "dateBtn";
          btn.type = "button";
          btn.dataset.date = d;
          const label = formatDateLabel(d);
          btn.innerHTML = `${escapeHtml(label)}<small>${done}/${total}</small>`;
          datesPanel.appendChild(btn);
        }
      }

      archiveCount.textContent = `${filtered.length} / ${dates.length} days`;

      if(pickedDate && !filtered.includes(pickedDate)){
        pickedDate = null;
        pickedDateText.textContent = "ë‚ ì§œë¥¼ ì„ íƒí•´ì¤˜";
        copyPickedBtn.disabled = true;
        carryPickedBtn.disabled = true;
        previewBox.innerHTML = `
          <div style="color: rgba(30,30,30,0.55); font-size:12px;">
            ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•´ì¤˜.
          </div>
        `;
      }else if(pickedDate){
        setActiveDateButton(pickedDate);
        renderPreview(pickedDate);
      }
    }

    function setActiveDateButton(dateStr){
      const btns = datesPanel.querySelectorAll(".dateBtn");
      btns.forEach(b => b.classList.toggle("active", b.dataset.date === dateStr));
    }

    function renderPreview(dateStr){
      const items = archive[dateStr] || [];
      const q = (searchQuery || "").trim();

      pickedDate = dateStr;
      setActiveDateButton(dateStr);

      pickedDateText.textContent = `ì„ íƒ: ${formatDateLabel(dateStr)}`;
      copyPickedBtn.disabled = false;
      carryPickedBtn.disabled = false;

      let view = items;
      if(q){
        const lowerQ = q.toLowerCase();
        view = items.filter(it => String(it.text || "").toLowerCase().includes(lowerQ) || dateStr.toLowerCase().includes(lowerQ));
      }

      if(!view || view.length === 0){
        previewBox.innerHTML = `<div style="color: rgba(30,30,30,0.55); font-size:12px;">í‘œì‹œí•  í•­ëª©ì´ ì—†ì–´.</div>`;
        return;
      }

      const rows = view.map(it => {
        const badgeCls = it.done ? "badge done" : "badge";
        const badgeText = it.done ? "done" : "todo";
        const textHtml = highlight(it.text || "", q);
        return `
          <div class="pItem">
            <span class="${badgeCls}">${badgeText}</span>
            <span style="${it.done ? "text-decoration:line-through; color:rgba(30,30,30,0.55);" : ""}">
              ${textHtml}
            </span>
          </div>
        `;
      }).join("");

      previewBox.innerHTML = rows;
    }

    // âœ… Popover helpers
    function placePopover(){
      const btnRect = copyTodayBtn.getBoundingClientRect();
      const popRect = copyPopover.getBoundingClientRect();

      const gap = 8;
      const pad = 8;

      // default: above button, right-aligned
      let top = btnRect.top - popRect.height - gap;
      let left = btnRect.right - popRect.width;

      // if not enough space above, place below
      if(top < pad) top = btnRect.bottom + gap;

      // clamp horizontally
      left = Math.max(pad, Math.min(left, window.innerWidth - popRect.width - pad));

      copyPopover.style.left = `${left}px`;
      copyPopover.style.top = `${top}px`;
    }

    function openCopyPopover(){
      if(modalOverlay.classList.contains("open")) return; // modal ì—´ë ¤ìˆì„ ë•ŒëŠ” ë°©í•´ ê¸ˆì§€
      copyPopover.classList.add("open");
      copyPopover.setAttribute("aria-hidden", "false");
      // next frame: ensure size is measurable
      requestAnimationFrame(placePopover);
    }

    function closeCopyPopover(){
      copyPopover.classList.remove("open");
      copyPopover.setAttribute("aria-hidden", "true");
    }

    // Events
    addBtn.addEventListener("click", () => {
      addItem(inputEl.value);
      inputEl.value = "";
      inputEl.focus();
      syncAddButtonState();
    });

    inputEl.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        if(!addBtn.disabled) addBtn.click();  // âœ… ë²„íŠ¼ê³¼ ë™ì¼ ë™ì‘
      }
    });

    listEl.addEventListener("click", (e) => {
      const check = e.target.closest(".check");
      const del = e.target.closest("[data-del]");
      if(check) toggleItem(check.dataset.id);
      else if(del) deleteItem(del.dataset.del);
    });

    listEl.addEventListener("keydown", (e) => {
      const check = e.target.closest(".check");
      if(!check) return;
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        toggleItem(check.dataset.id);
      }
    });

    if (clearDoneBtn) clearDoneBtn.addEventListener("click", clearDone);
    if (resetBtn) resetBtn.addEventListener("click", resetAll);

    carryYesterdayBtn.addEventListener("click", carryOverYesterday);
    historyBtn.addEventListener("click", openModal);

    // âœ… Toggle popover
    copyTodayBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      if(copyPopover.classList.contains("open")) closeCopyPopover();
      else openCopyPopover();
    });

    // âœ… choose copy mode
    copyPopover.addEventListener("click", (e) => {
      e.stopPropagation();
      const btn = e.target.closest("[data-copy]");
      if(!btn) return;
      const mode = btn.dataset.copy || "all";
      closeCopyPopover();
      copyToday(mode);
    });

    // âœ… close on outside click / Esc
    document.addEventListener("click", () => closeCopyPopover());
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape") closeCopyPopover();
    });

    // âœ… reposition on resize/scroll (not heavy)
    window.addEventListener("resize", () => {
      if(copyPopover.classList.contains("open")) placePopover();
    }, { passive: true });

    window.addEventListener("scroll", () => {
      if(copyPopover.classList.contains("open")) placePopover();
    }, { passive: true });

    // Modal events
    closeModalBtn.addEventListener("click", closeModal);
    modalOverlay.addEventListener("click", (e) => {
      if(e.target === modalOverlay) closeModal();
    });

    datesPanel.addEventListener("click", (e) => {
      const btn = e.target.closest(".dateBtn");
      if(!btn) return;
      renderPreview(btn.dataset.date);
    });

    copyPickedBtn.addEventListener("click", copyPicked);

    carryPickedBtn.addEventListener("click", () => {
      if(!pickedDate) return;
      carryOverUnfinishedFromDate(pickedDate);
    });

    searchInput.addEventListener("input", () => {
      searchQuery = (searchInput.value || "").trim();
      buildDates();
    });

    clearSearchBtn.addEventListener("click", () => {
      searchInput.value = "";
      searchQuery = "";
      buildDates();
      showToast("ê²€ìƒ‰ì„ ì´ˆê¸°í™”í–ˆì–´.");
    });

    render();
  </script>
</body>
</html>
